import nativeTest;
import alloc;
import puts;
import std.printf;
import std.malloc;

//stored in static data section
message: "hello, world";

export main:
    nullop;

    move 10, a0;
    ecall alloc;

    move a7, c0;

    write8 'H', c0; 
    iadd c0, 1, c0;
    write8 'e', c0;
    iadd c0, 1, c0;
    write8 'l', c0;
    iadd c0, 1, c0;
    write8 'l', c0;
    iadd c0, 1, c0;
    write8 'o', c0;
    iadd c0, 1, c0;
    write8 '!', c0;
    iadd c0, 1, c0;

    isub c0, a7, c1; //len

    move a7, a0;
    move c1, a1;
    ecall puts;

    return;

export _start:
    call main;
    return;

panic_message: "Program panic!"; //len = 14

//panic handler
export panic: 
    move panic_message, a0;
    move 14, a1;
    extcall puts;

    //current encoding doesn't allow two immediates, but will do soon
    write8 0, 0x00;
    unreachable;

recurse: jump recurse;